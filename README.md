# ğŸŒ IPåœ°ç†ä½ç½®æŸ¥è¯¢API

è¿™æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å®ç°çš„é«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§ IP åœ°ç†ä½ç½®æŸ¥è¯¢ API æœåŠ¡ï¼Œæ”¯æŒå…¨çƒ IP åœ°å€æŸ¥è¯¢ï¼Œä¸­å›½å¤§é™†åœ°åŒºç²¾ç¡®åˆ°åŒºå¿çº§åˆ«ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ åœ°ç†ä½ç½®æŸ¥è¯¢
- **å…¨çƒè¦†ç›–**: æ”¯æŒå…¨çƒ IPv4/IPv6 åœ°å€æŸ¥è¯¢
- **é«˜ç²¾åº¦å®šä½**: ä¸­å›½å¤§é™†åœ°åŒºç²¾ç¡®åˆ°åŒºå¿çº§åˆ«
- **å¤šæ•°æ®æº**: é›†æˆ MaxMind GeoLite2 å’Œ GeoCN æ•°æ®åº“
- **ä¸°å¯Œå­—æ®µ**: æä¾›30+åœ°ç†ä½ç½®ã€ISPã€ASNç­‰ä¿¡æ¯å­—æ®µ

### âš¡ æ€§èƒ½ä¼˜åŒ–
- **å†…å­˜ç¼“å­˜**: æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œè‡ªåŠ¨è¿‡æœŸç®¡ç†
- **å¹¶å‘å®‰å…¨**: è¯»å†™é”ä¿æŠ¤ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®
- **å¿«é€Ÿå“åº”**: æ¯«ç§’çº§æŸ¥è¯¢å“åº”æ—¶é—´
- **èµ„æºä¼˜åŒ–**: åˆç†çš„å†…å­˜å’ŒCPUä½¿ç”¨

### ğŸ”’ å®‰å…¨é˜²æŠ¤
- **é€Ÿç‡é™åˆ¶**: æ™ºèƒ½é€Ÿç‡æ§åˆ¶ä¿æŠ¤
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„IPåœ°å€æ ¼å¼éªŒè¯
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯åˆ†ç±»å’Œå“åº”
- **è¶…æ—¶æ§åˆ¶**: é˜²æ­¢æ…¢é€Ÿæ”»å‡»å’Œèµ„æºè€—å°½

### ğŸ”„ è‡ªåŠ¨åŒ–è¿ç»´
- **è‡ªåŠ¨æ›´æ–°**: æ¯24å°æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°æ•°æ®åº“
- **åŸå­æ›´æ–°**: å®‰å…¨çš„æ•°æ®åº“çƒ­æ›´æ–°æœºåˆ¶
- **ä¼˜é›…å…³é—­**: æ”¯æŒä¿¡å·å¤„ç†å’Œä¼˜é›…åœæœº
- **å¥åº·ç›‘æ§**: å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯è¿½è¸ª

## ğŸ›¡ï¸ é˜²æŠ¤æœºåˆ¶

### é€Ÿç‡é™åˆ¶ (Rate Limiting)
- **ç®—æ³•**: åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„é€Ÿç‡æ§åˆ¶
- **é™åˆ¶è§„åˆ™**: åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„æ™ºèƒ½é™æµ
- **å­˜å‚¨æ–¹å¼**: å†…å­˜ä¸­ç»´æŠ¤å®¢æˆ·ç«¯é™åˆ¶å™¨æ˜ å°„
- **è¶…é™å¤„ç†**: è¿”å› `429 Too Many Requests` çŠ¶æ€ç 

### è¾“å…¥å®‰å…¨éªŒè¯
- **IPæ ¼å¼éªŒè¯**: ä½¿ç”¨ `net.ParseIP()` ä¸¥æ ¼éªŒè¯
- **ç‰¹æ®ŠIPå¤„ç†**: è‡ªåŠ¨è¯†åˆ«ç§æœ‰IPã€ç¯å›åœ°å€ã€é“¾è·¯æœ¬åœ°åœ°å€
- **é”™è¯¯åˆ†ç±»**: åŒºåˆ†å®¢æˆ·ç«¯é”™è¯¯å’ŒæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- **å‹å¥½å“åº”**: é’ˆå¯¹ä¸åŒé”™è¯¯ç±»å‹è¿”å›ç›¸åº”æ¶ˆæ¯

### HTTPå®‰å…¨é…ç½®
- **è¶…æ—¶è®¾ç½®**: è¯»å–5ç§’ã€å†™å…¥10ç§’ã€ç©ºé—²120ç§’
- **CORSæ§åˆ¶**: é™åˆ¶è¯·æ±‚æ–¹æ³•ä¸ºGETå’ŒOPTIONS
- **è·¯ç”±ä¿æŠ¤**: åªæš´éœ²å¿…è¦çš„APIç«¯ç‚¹
- **åè®®å®‰å…¨**: æ”¯æŒHTTPSéƒ¨ç½²

### èµ„æºä¿æŠ¤
- **å†…å­˜ç®¡ç†**: å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜é¡¹
- **è¿æ¥ç®¡ç†**: åˆç†çš„æ•°æ®åº“è¿æ¥æ± 
- **å¹¶å‘æ§åˆ¶**: é˜²æ­¢èµ„æºç«äº‰å’Œæ­»é”
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•å’Œæ•…éšœè½¬ç§»æœºåˆ¶

## API ä½¿ç”¨è¯´æ˜

### ç«¯ç‚¹

#### IP åœ°ç†ä½ç½®æŸ¥è¯¢
- `GET /json/{ip}`: æŸ¥è¯¢æŒ‡å®š IP åœ°å€çš„åœ°ç†ä½ç½®ä¿¡æ¯ã€‚
- `GET /json`: æŸ¥è¯¢å®¢æˆ·ç«¯è‡ªèº« IP åœ°å€çš„åœ°ç†ä½ç½®ä¿¡æ¯ã€‚

#### é™æ€åœ°å›¾æœåŠ¡
- `GET /map`: è·å–é™æ€åœ°å›¾å›¾ç‰‡ï¼ˆä»£ç† Geoapify Static Map APIï¼‰ã€‚

### è¯·æ±‚ç¤ºä¾‹

#### IP åœ°ç†ä½ç½®æŸ¥è¯¢

æŸ¥è¯¢ç‰¹å®š IP (ä¾‹å¦‚ `8.8.8.8`):

```bash
curl http://localhost:8180/json/8.8.8.8
```

æŸ¥è¯¢è‡ªå·±çš„ IP:

```bash
curl http://localhost:8180/json
```

#### é™æ€åœ°å›¾æœåŠ¡

è·å–æŒ‡å®šä½ç½®çš„é™æ€åœ°å›¾:

```bash
# åŸºæœ¬åœ°å›¾ï¼ˆéœ€è¦æŒ‡å®šä¸­å¿ƒç‚¹åæ ‡ï¼‰
curl "http://localhost:8180/map?style=osm-carto&width=400&height=300&center=lonlat:116.3974,39.9093&zoom=10" > map.png

# å¸¦æ ‡è®°çš„åœ°å›¾
curl "http://localhost:8180/map?style=osm-carto&width=400&height=300&center=lonlat:116.3974,39.9093&zoom=10&marker=lonlat:116.3974,39.9093;color:%23ff0000;size:medium" > map_with_marker.png

# è‡ªå®šä¹‰æ ·å¼åœ°å›¾
curl "http://localhost:8180/map?style=osm-bright&width=600&height=400&center=lonlat:-74.006,40.7128&zoom=12" > nyc_map.png
```

**æ”¯æŒçš„å‚æ•°:**
- `style`: åœ°å›¾æ ·å¼ (osm-carto, osm-bright, klokantech-basic, etc.)
- `width`: å›¾ç‰‡å®½åº¦ (æœ€å¤§ 2048px)
- `height`: å›¾ç‰‡é«˜åº¦ (æœ€å¤§ 2048px) 
- `center`: åœ°å›¾ä¸­å¿ƒç‚¹ (æ ¼å¼: lonlat:ç»åº¦,çº¬åº¦)
- `zoom`: ç¼©æ”¾çº§åˆ« (1-20)
- `marker`: æ ‡è®°ç‚¹ (æ ¼å¼: lonlat:ç»åº¦,çº¬åº¦;color:é¢œè‰²;size:å¤§å°)
- `format`: è¾“å‡ºæ ¼å¼ (png, jpg)

æ›´å¤šå‚æ•°è¯·å‚è€ƒ [Geoapify Static Map API æ–‡æ¡£](https://apidocs.geoapify.com/docs/maps/static/)ã€‚

### HTTPçŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ | å“åº”ç¤ºä¾‹ |
|--------|------|----------|
| 200 OK | æŸ¥è¯¢æˆåŠŸ | æ­£å¸¸çš„JSONæ•°æ® |
| 200 OK | ç§æœ‰IPåœ°å€ | `{"ip": "192.168.1.1", "message": "private range"}` |
| 200 OK | ä¿ç•™IPåœ°å€ | `{"ip": "127.0.0.1", "message": "reserved range"}` |
| 200 OK | IPä¸åœ¨æ•°æ®åº“ä¸­ | `{"ip": "1.2.3.4", "message": "not in database"}` |
| 400 Bad Request | IPæ ¼å¼æ— æ•ˆ | `{"ip": "invalid.ip", "message": "invalid query"}` |
| 429 Too Many Requests | è¯·æ±‚é¢‘ç‡è¶…é™ | `Too Many Requests` |
| 500 Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | `{"ip": "8.8.8.8", "message": "internal error"}` |

### å“åº”æ ¼å¼

æˆåŠŸçš„å“åº”å°†è¿”å›ä¸€ä¸ªåŒ…å«åœ°ç†ä½ç½®ä¿¡æ¯çš„ JSON å¯¹è±¡ã€‚

```json
{
  "ip": "8.8.8.8",
  "network": "8.8.8.0/24",
  "version": "IPv4",
  "city": "å±±æ™¯åŸ",
  "city_code": 0,
  "region": "åŠ åˆ©ç¦å°¼äºšå·",
  "region_code": "CA",
  "province_code": 0,
  "districts": "",
  "districts_code": 0,
  "country": "US",
  "country_name": "ç¾å›½",
  "country_code": "US",
  "country_code_iso3": "USA",
  "country_capital": "åç››é¡¿",
  "country_tld": ".us",
  "continent_code": "NA",
  "in_eu": false,
  "postal": "94043",
  "latitude": 37.4056,
  "longitude": -122.0775,
  "timezone": "America/Los_Angeles",
  "utc_offset": "-08:00",
  "country_calling_code": "+1",
  "currency": "USD",
  "currency_name": "ç¾å…ƒ",
  "languages": "en-US,es-US,haw,fr",
  "country_area": 9629091.0,
  "country_population": 310232863,
  "asn": "AS15169",
  "org": "Google LLC",
  "isp": "Google"
}
```

### å­—æ®µè¿‡æ»¤

æ‚¨å¯ä»¥é€šè¿‡ `fields` æŸ¥è¯¢å‚æ•°æ¥æŒ‡å®šè¿”å›çš„å­—æ®µï¼Œå¤šä¸ªå­—æ®µç”¨é€—å·åˆ†éš”ã€‚

```bash
curl "http://localhost:8180/json/8.8.8.8?fields=ip,country_name,city_name,asn"
```

å“åº”:

```json
{
  "ip": "8.8.8.8",
  "country_name": "United States",
  "city_name": "Mountain View",
  "asn": 15169
}
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Server   â”‚    â”‚   Middleware    â”‚    â”‚   API Handler   â”‚
â”‚                 â”‚â”€â”€â”€â”€â”‚                 â”‚â”€â”€â”€â”€â”‚                 â”‚
â”‚ â€¢ è·¯ç”±ç®¡ç†      â”‚    â”‚ â€¢ é€Ÿç‡é™åˆ¶      â”‚    â”‚ â€¢ IPæŸ¥è¯¢å¤„ç†    â”‚
â”‚ â€¢ é™æ€æ–‡ä»¶      â”‚    â”‚ â€¢ CORSæ”¯æŒ      â”‚    â”‚ â€¢ ç¼“å­˜ç®¡ç†      â”‚
â”‚ â€¢ ä¼˜é›…å…³é—­      â”‚    â”‚ â€¢ é”™è¯¯å¤„ç†      â”‚    â”‚ â€¢ å“åº”æ ¼å¼åŒ–    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GeoIP Module  â”‚    â”‚   Cache System  â”‚    â”‚   Auto Updater  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æ•°æ®åº“ç®¡ç†    â”‚    â”‚ â€¢ å†…å­˜ç¼“å­˜      â”‚    â”‚ â€¢ å®šæ—¶æ›´æ–°      â”‚
â”‚ â€¢ å¹¶å‘å®‰å…¨      â”‚    â”‚ â€¢ è¿‡æœŸæ¸…ç†      â”‚    â”‚ â€¢ åŸå­æ›¿æ¢      â”‚
â”‚ â€¢ å¤šæ•°æ®æº      â”‚    â”‚ â€¢ å‘½ä¸­ç»Ÿè®¡      â”‚    â”‚ â€¢ é”™è¯¯é‡è¯•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµç¨‹

1. **è¯·æ±‚æ¥æ”¶**: HTTPæœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚
2. **ä¸­é—´ä»¶å¤„ç†**: é€Ÿç‡é™åˆ¶ â†’ CORSæ£€æŸ¥ â†’ è¯·æ±‚éªŒè¯
3. **ç¼“å­˜æŸ¥è¯¢**: æ£€æŸ¥å†…å­˜ç¼“å­˜æ˜¯å¦å­˜åœ¨ç»“æœ
4. **æ•°æ®åº“æŸ¥è¯¢**: ç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢GeoIPæ•°æ®åº“
5. **ç»“æœå¤„ç†**: æ ¼å¼åŒ–å“åº”æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
6. **å“åº”è¿”å›**: è¿”å›JSONæ ¼å¼çš„æŸ¥è¯¢ç»“æœ

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.18+
- **HTTPæ¡†æ¶**: æ ‡å‡†åº“ `net/http`
- **GeoIPåº“**: `github.com/oschwald/geoip2-golang`
- **ç¼“å­˜**: `github.com/patrickmn/go-cache`
- **é™æµ**: `golang.org/x/time/rate`
- **æ•°æ®åº“**: MaxMind GeoLite2 + GeoCN MMDB

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- [Go](https://golang.org/dl/) (ç‰ˆæœ¬ 1.18 æˆ–æ›´é«˜)
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºä¸‹è½½æ•°æ®åº“æ–‡ä»¶ï¼‰

### å®‰è£…ä¸è¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/sd1114820/ip-source-api-web.git
   cd ip-source-api-web
   ```

2. **ä¸‹è½½ä¾èµ–**
   ```bash
   go mod tidy
   ```

3. **ç¼–è¯‘é¡¹ç›®**
   ```bash
   go build -o ip-source-api-web
   ```

4. **è¿è¡ŒæœåŠ¡**
   ```bash
   ./ip-source-api-web
   ```

5. **éªŒè¯æœåŠ¡**
   ```bash
   curl http://localhost:8180/json/8.8.8.8
   ```

### å¼€å‘æ¨¡å¼

```bash
# ç›´æ¥è¿è¡Œï¼ˆå¼€å‘æ¨¡å¼ï¼‰
go run main.go

# çƒ­é‡è½½ï¼ˆéœ€è¦å®‰è£…airï¼‰
go install github.com/cosmtrek/air@latest
air
```

## âš™ï¸ é…ç½®è¯´æ˜

æœ¬é¡¹ç›®çš„æ‰€æœ‰é…ç½®é¡¹å‡å·²åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ï¼Œå¦‚éœ€ä¿®æ”¹è¯·ç¼–è¾‘ `config/config.go` æ–‡ä»¶å¹¶é‡æ–°ç¼–è¯‘ã€‚

### ä¸»è¦é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| ListenAddr | `0.0.0.0:8180` | æœåŠ¡ç›‘å¬åœ°å€å’Œç«¯å£ |
| DataDir | `data` | æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ç›®å½• |
| UpdateInterval | `24` | æ•°æ®åº“æ›´æ–°é—´éš”ï¼ˆå°æ—¶ï¼‰ |
| ReadTimeout | `5s` | HTTPè¯»å–è¶…æ—¶æ—¶é—´ |
| WriteTimeout | `10s` | HTTPå†™å…¥è¶…æ—¶æ—¶é—´ |
| IdleTimeout | `120s` | HTTPç©ºé—²è¶…æ—¶æ—¶é—´ |
| MaxMindLicenseKey | `ç¡¬ç¼–ç é…ç½®` | MaxMind APIå¯†é’¥ï¼ˆéœ€åœ¨config.goä¸­ç›´æ¥è®¾ç½®ï¼‰ |
| GeoapifyAPIKey | `ç¡¬ç¼–ç é…ç½®` | Geoapify APIå¯†é’¥ï¼ˆç”¨äºé™æ€åœ°å›¾æœåŠ¡ï¼Œéœ€åœ¨config.goä¸­ç›´æ¥è®¾ç½®ï¼‰ |

### é€Ÿç‡é™åˆ¶é…ç½®

- **è¯·æ±‚é¢‘ç‡**: Xæ¬¡/åˆ†é’Ÿ
- **çªå‘å…è®¸**: Xæ¬¡
- **ç®—æ³•**: ä»¤ç‰Œæ¡¶
- **å­˜å‚¨**: å†…å­˜æ˜ å°„

### ç¼“å­˜é…ç½®

- **è¿‡æœŸæ—¶é—´**: Xåˆ†é’Ÿ
- **æ¸…ç†é—´éš”**: Xåˆ†é’Ÿ
- **å­˜å‚¨æ–¹å¼**: å†…å­˜
- **é”®æ ¼å¼**: `{ip}?fields={fields}`

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æµ‹è¯•

åœ¨æ ‡å‡†ç¡¬ä»¶é…ç½®ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼š

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å“åº”æ—¶é—´ | < 5ms | ç¼“å­˜å‘½ä¸­æ—¶ |
| å“åº”æ—¶é—´ | < 50ms | æ•°æ®åº“æŸ¥è¯¢æ—¶ |
| å¹¶å‘å¤„ç† | 1000+ QPS | å•æ ¸å¿ƒå¤„ç†èƒ½åŠ› |
| å†…å­˜ä½¿ç”¨ | < 100MB | åŒ…å«æ•°æ®åº“å’Œç¼“å­˜ |
| CPUä½¿ç”¨ | < 5% | æ­£å¸¸è´Ÿè½½ä¸‹ |

### å®¹é‡è§„åˆ’

- **æ•°æ®åº“å¤§å°**: ~200MBï¼ˆæ‰€æœ‰MMDBæ–‡ä»¶ï¼‰
- **å†…å­˜ç¼“å­˜**: æ ¹æ®è®¿é—®æ¨¡å¼åŠ¨æ€è°ƒæ•´
- **ç£ç›˜ç©ºé—´**: å»ºè®®é¢„ç•™1GBç”¨äºæ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶
- **ç½‘ç»œå¸¦å®½**: æ¯ä¸ªè¯·æ±‚çº¦1-2KBå“åº”æ•°æ®

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—çº§åˆ«

- **INFO**: æ­£å¸¸æ“ä½œæ—¥å¿—
- **WARN**: è­¦å‘Šä¿¡æ¯ï¼ˆå¦‚IPä¸åœ¨æ•°æ®åº“ä¸­ï¼‰
- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“è®¿é—®å¤±è´¥ï¼‰

### ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š

1. **è¯·æ±‚æŒ‡æ ‡**
   - QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
   - å“åº”æ—¶é—´åˆ†å¸ƒ
   - é”™è¯¯ç‡ç»Ÿè®¡

2. **ç¼“å­˜æŒ‡æ ‡**
   - ç¼“å­˜å‘½ä¸­ç‡
   - ç¼“å­˜å¤§å°
   - è¿‡æœŸæ¸…ç†é¢‘ç‡

3. **ç³»ç»ŸæŒ‡æ ‡**
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨é‡
   - ç£ç›˜I/O

### å¥åº·æ£€æŸ¥

```bash
# åŸºæœ¬å¥åº·æ£€æŸ¥
curl -f http://localhost:8180/json/8.8.8.8 || exit 1

# è¯¦ç»†çŠ¶æ€æ£€æŸ¥
curl -s http://localhost:8180/json/8.8.8.8 | jq '.ip' || exit 1
```

## éƒ¨ç½²

### ç›´æ¥éƒ¨ç½²

å°†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ `ip-source-api-web` å’Œ `data` ç›®å½•ï¼ˆå¦‚æœéœ€è¦ä¿ç•™ç°æœ‰æ•°æ®åº“ï¼‰ä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨ã€‚è®¾ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚å»ºè®®ä½¿ç”¨ `systemd` æˆ– `supervisor` ç­‰å·¥å…·æ¥ç®¡ç†è¿›ç¨‹ï¼Œä»¥ç¡®ä¿æœåŠ¡åœ¨åå°æŒç»­è¿è¡Œå¹¶èƒ½è‡ªåŠ¨é‡å¯ã€‚

### Docker éƒ¨ç½² (æ¨è)

æ‚¨ä¹Ÿå¯ä»¥ä¸ºè¯¥åº”ç”¨åˆ›å»ºä¸€ä¸ª `Dockerfile` æ¥è¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–ç¯å¢ƒä¾èµ–å’Œéƒ¨ç½²æµç¨‹ã€‚

### Dockeréƒ¨ç½² (æ¨è)

**ç¤ºä¾‹ `Dockerfile`:**

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Go é•œåƒä½œä¸ºæ„å»ºç¯å¢ƒ
FROM golang:1.23-alpine AS builder

WORKDIR /app

# å¤åˆ¶ go.mod å’Œ go.sum å¹¶ä¸‹è½½ä¾èµ–
COPY go.mod go.sum ./
RUN go mod download

# å¤åˆ¶æºä»£ç 
COPY . .

# ç¼–è¯‘åº”ç”¨
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o ip-source-api-web .

# ä½¿ç”¨ä¸€ä¸ªè½»é‡çš„åŸºç¡€é•œåƒæ¥è¿è¡Œåº”ç”¨
FROM alpine:latest

# å®‰è£…å¿…è¦çš„å·¥å…·
RUN apk --no-cache add ca-certificates tzdata

WORKDIR /root/

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/ip-source-api-web .
COPY --from=builder /app/index.html .

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir ./data

# æš´éœ²ç«¯å£
EXPOSE 8180

# è¿è¡Œåº”ç”¨
CMD ["./ip-source-api-web"]
```

**æ„å»ºå’Œè¿è¡Œ:**

```bash
# æ„å»ºé•œåƒ
docker build -t ip-source-api-web .

# è¿è¡Œå®¹å™¨
docker run -d -p 8180:8180 --name ip-source-api-web ip-source-api-web

# ä½¿ç”¨docker-compose
cat > docker-compose.yml << EOF
version: '3.8'
services:
  ip-source-api-web:
    build: .
    ports:
      - "8180:8180"
    volumes:
      - ./data:/root/data
    restart: unless-stopped
EOF

docker-compose up -d
```

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæŸ¥è¯¢æŸäº›IPè¿”å›"not in database"ï¼Ÿ
A: è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¯èƒ½çš„åŸå› ï¼š
- IPåœ°å€æ˜¯æ–°åˆ†é…çš„ï¼Œå°šæœªè¢«æ•°æ®åº“æ”¶å½•
- IPåœ°å€å±äºç‰¹æ®Šç”¨é€”ï¼ˆå¦‚æµ‹è¯•ã€æ–‡æ¡£ç¤ºä¾‹ç­‰ï¼‰
- æ•°æ®åº“æ›´æ–°å­˜åœ¨å»¶è¿Ÿ

### Q: å¦‚ä½•æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Ÿ
A: å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š
- å¢åŠ æœåŠ¡å™¨å†…å­˜ä»¥æ‰©å¤§ç¼“å­˜å®¹é‡
- ä½¿ç”¨SSDå­˜å‚¨ä»¥æé«˜æ•°æ®åº“è¯»å–é€Ÿåº¦
- éƒ¨ç½²å¤šä¸ªå®ä¾‹å¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡
- è°ƒæ•´ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆåœ¨å‡†ç¡®æ€§å’Œæ€§èƒ½é—´å¹³è¡¡ï¼‰

### Q: æ•°æ®åº“å¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Ÿ
A: ç³»ç»Ÿæ¯24å°æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½æœ€æ–°çš„æ•°æ®åº“æ–‡ä»¶ã€‚MaxMindé€šå¸¸æ¯å‘¨äºŒæ›´æ–°GeoLite2æ•°æ®åº“ã€‚

### Q: æ”¯æŒIPv6å—ï¼Ÿ
A: æ˜¯çš„ï¼Œç³»ç»Ÿå®Œå…¨æ”¯æŒIPv6åœ°å€æŸ¥è¯¢ï¼Œä½¿ç”¨ç›¸åŒçš„APIæ¥å£ã€‚

### Q: å¦‚ä½•è‡ªå®šä¹‰è¿”å›å­—æ®µï¼Ÿ
A: ä½¿ç”¨`fields`å‚æ•°æŒ‡å®šéœ€è¦çš„å­—æ®µï¼Œä¾‹å¦‚ï¼š
```bash
curl "http://localhost:8180/json/8.8.8.8?fields=ip,country_name,city"
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### æœåŠ¡æ— æ³•å¯åŠ¨
1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tlnp | grep 8180`
2. æ£€æŸ¥æ•°æ®ç›®å½•æƒé™ï¼š`ls -la data/`
3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### æŸ¥è¯¢è¿”å›é”™è¯¯
1. éªŒè¯IPåœ°å€æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼š`ls -la data/*.mmdb`
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### æ€§èƒ½é—®é¢˜
1. ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
2. æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
3. åˆ†æè®¿é—®æ¨¡å¼å’Œçƒ­ç‚¹IP

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/sd1114820/ip-source-api-web.git
cd ip-source-api-web

# å®‰è£…ä¾èµ–
go mod tidy

# è¿è¡Œæµ‹è¯•
go test ./...

# ä»£ç æ ¼å¼åŒ–
go fmt ./...

# é™æ€æ£€æŸ¥
go vet ./...
```

### æäº¤è§„èŒƒ
- ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
- ç¡®ä¿ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•
- éµå¾ªGoä»£ç è§„èŒƒ
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [MaxMind](https://www.maxmind.com/) - æä¾›GeoLite2æ•°æ®åº“
- [GeoCN](https://github.com/ljxi/GeoCN) - æä¾›ä¸­å›½åœ°åŒºç²¾ç¡®æ•°æ®
- [geoip2-golang](https://github.com/oschwald/geoip2-golang) - Goè¯­è¨€GeoIPåº“

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼**